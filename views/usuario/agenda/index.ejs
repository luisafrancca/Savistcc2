<div class="col-12 d-flex flex-column align-items-center mt-4">
  <div class="d-flex justify-content-center align-items-center mb-4" style="gap: 10px;">
    <form method="GET" class="d-flex" style="gap:10px">
      <input 
        type="search" 
        name="cidade" 
        value="<%= termoCidade %>" 
        placeholder="Pesquisar por cidade" 
        class="form-control pesquisa-custom" 
        style="max-width: 250px"
      >
      <input 
        type="date" 
        name="data" 
        value="<%= termoData %>" 
        class="form-control pesquisa-custom" 
        style="max-width: 200px"
      >
    </form>
  </div>

  <% viagens.forEach(function(viagem) { %>
    <div class="card shadow-sm mt-2" style="width:100%; max-width:700px; border-radius:10px; background-color:#d1e3fd;">
      <div class="card-header d-flex justify-content-between align-items-center" style="background-color:#a7c9f9; border-top-left-radius:10px; border-top-right-radius:10px;">
        <span class="fw-bold" style="color:#062352; font-size:16px;"><%= viagem.cidadeconsul.descricao %></span>
        <span class="fw-bold" style="color:#062352; font-size:15px;" data-date="<%= viagem.data_viagem %>"><%= viagem.data_viagem.split('-').reverse().join('/') %></span>
      </div>

      <div class="card-body d-flex justify-content-between align-items-center">
        <div class="flex-grow-1">
          <img src="/assets/pessoa-azul.png" alt="Ícone de Usuário" class="mb-1" style="width:20px; height:20px;">
          <%= viagem.ocupacao %>/<%= viagem.veiculo.lugares_dispo %> Lugares Ocupados
        </div>

        <% const participa = viagem.participantes.some(p => p.usuarioID === codUsuario);
            const lotada = viagem.ocupacao >= viagem.veiculo.lugares_dispo;
            const dataViagem = new Date(viagem.data_viagem).toISOString().slice(0, 10);
            const jaSolicitouNessaData = datasSolicitadas.includes(dataViagem);
            const participaNessaData = datasParticipando.includes(dataViagem);%>

          <% if (participa) { %>
            <a href="/usuario/inicio/index" class="botao">Participando</a>
          <% } else if (lotada || jaSolicitouNessaData || participaNessaData) { %>
            <a class="botao-desabilitado disabled">Participar</a>
          <% } else { %>
            <a href="/usuario/agenda/formulario-participar/<%= viagem.cod %>" class="botao">Participar</a>
          <% } %>
      </div>
    </div>
  <% }) %>

  <% if (viagens.length === 0) { %>
    <p class="text-center text-muted mt-4">Nenhuma viagem encontrada.</p>
  <% } else { %>
    <!-- PAGINAÇÃO -->
    <div class="d-flex justify-content-center mt-4">
      <% if (paginaNun > 1) { %>
        <a href="?page=<%= paginaNun - 1 %>&cidade=<%= termoCidade %>&data=<%= termoData %>" class="botao-paginacao">‹</a>
      <% } else { %>
        <button class="botao-paginacao" disabled>‹</button>
      <% } %>

      <% for (let i = 1; i <= totalPaginas; i++) { %>
        <a 
          href="?page=<%= i %>&cidade=<%= termoCidade %>&data=<%= termoData %>"
          class="botao-paginacao <%= i === paginaNun ? 'ativo' : '' %>"
        ><%= i %></a>
      <% } %>

      <% if (paginaNun < totalPaginas) { %>
        <a href="?page=<%= paginaNun + 1 %>&cidade=<%= termoCidade %>&data=<%= termoData %>" class="botao-paginacao">›</a>
      <% } else { %>
        <button class="botao-paginacao" disabled>›</button>
      <% } %>
    </div>
  <% } %>
</div>
<% if (solicitacaoSucesso) { %>
        <script>
          alert('Solicitação realizada com sucesso!');
        </script>
<% } %>

<script>
  const form = document.querySelector('form');
  const inputData = form.querySelector('input[name="data"]');

  inputData.addEventListener('blur', () => {
    if (inputData.value) {
      form.submit();
    }
  });
</script>
